<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crossword Game</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #4ECDC4 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: auto;
        }

        .screen {
            display: none;
            min-height: 100vh;
            padding: 20px;
        }

        .screen.active {
            display: block;
        }

        /* Dashboard Styles */
        .dashboard {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
            animation: fadeInUp 1s ease;
            min-height: 100vh; /* Tambahan untuk memusatkan secara vertikal */
        }

        .game-title {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-subtitle {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .player-input {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            padding: 15px 20px;
            font-size: 1.1rem;
            color: white;
            margin-bottom: 1.5rem;
            width: 300px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .player-input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        /* Game Styles */
        .game-container {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            color: white;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .game-stats {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: 600;
        }

        .game-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            align-items: start;
        }

        .crossword-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .crossword-grid {
            display: inline-grid;
            gap: 2px;
            background: #333;
            padding: 10px;
            border-radius: 10px;
        }

        .cell {
            width: 35px;
            height: 35px;
            background: white;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
        }

        .cell.blocked {
            background: #333;
            cursor: default;
        }

        .cell input {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            background: transparent;
        }

        .cell input:focus {
            outline: 2px solid #4ECDC4;
            background: rgba(78, 205, 196, 0.1);
        }

        .cell.highlight {
            background: rgba(78, 205, 196, 0.3);
        }
        
        /* New styles for answer correction */
        .cell.correct {
            background-color: #4CAF50; /* Hijau */
            color: white;
        }

        .cell.incorrect {
            background-color: #F44336; /* Merah */
            color: white;
        }

        .cell-number {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 10px;
            font-weight: bold;
            color: #666;
        }

        .clues-panel {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            height: fit-content;
        }

        .clues-section {
            margin-bottom: 20px;
        }

        .clues-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #FFD700;
        }

        .clue-item {
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clue-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }

        .clue-item.active {
            background: rgba(78, 205, 196, 0.3);
            border-left: 4px solid #4ECDC4;
        }

        /* Leaderboard Styles */
        .leaderboard {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
        }

        .leaderboard-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 2rem;
            color: #FFD700;
        }

        .score-display {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
        }

        .final-score {
            font-size: 2rem;
            font-weight: 600;
            color: #4ECDC4;
        }

        .leaderboard-table {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            max-width: 500px;
            backdrop-filter: blur(10px);
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            font-weight: 500;
        }

        .leaderboard-entry:first-child {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #333;
        }

        .leaderboard-entry:nth-child(2) {
            background: rgba(192, 192, 192, 0.3);
        }

        .leaderboard-entry:nth-child(3) {
            background: rgba(205, 127, 50, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .game-content {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .game-title {
                font-size: 2.5rem;
            }
            
            .crossword-grid {
                transform: scale(0.8);
                transform-origin: top left;
            }
            
            .cell {
                width: 30px;
                height: 30px;
            }
            
            .cell input {
                font-size: 14px;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .popup-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
        }

        .help-btn {
            background: linear-gradient(45deg, #FFA500, #FF6347);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            margin: 0 10px;
        }

        .help-count {
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div id="dashboardScreen" class="screen active">
        <div class="dashboard">
            <h1 class="game-title">üß© Teka-Teki Silang</h1>
            <p class="game-subtitle">Mari Mengasah Otak Dengan Bermain Teka-Teki Silang</p>
            <input type="text" id="playerName" class="player-input" placeholder="Masukkan nama Anda" maxlength="20">
            <div>
                <button class="btn" onclick="startGame()">üéÆ Mulai Bermain</button>
                <button class="btn" onclick="showLeaderboard()">üèÜ Peringkat</button>
            </div>
        </div>
    </div>

    <div id="gameScreen" class="screen">
        <div class="game-container">
            <div class="game-header">
                <div class="game-stats">
                    <div class="stat-item">Pemain: <span id="currentPlayer"></span></div>
                    <div class="stat-item">Skor: <span id="currentScore">0</span></div>
                    <div class="stat-item">Waktu: <span id="gameTimer">00:00</span></div>
                    <div class="help-count">Bantuan: <span id="helpCount">5</span>/5</div>
                </div>
                <div>
                    <button class="help-btn" onclick="getHelp()">üí° Bantuan</button>
                    <button class="btn" onclick="finishGame()">‚úÖ Selesai</button>
                    <button class="btn" onclick="backToDashboard()">üè† Beranda</button>
                </div>
            </div>
            
            <div class="game-content">
                <div class="crossword-container">
                    <div id="crosswordGrid" class="crossword-grid"></div>
                </div>
                
                <div class="clues-panel">
                    <div class="clues-section">
                        <h3 class="clues-title">‚¨áÔ∏è Menurun</h3>
                        <div id="downClues"></div>
                    </div>
                    <div class="clues-section">
                        <h3 class="clues-title">‚û°Ô∏è Mendatar</h3>
                        <div id="acrossClues"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="leaderboardScreen" class="screen">
        <div class="leaderboard">
            <h2 class="leaderboard-title">üèÜ Papan Peringkat</h2>
            <div id="scoreDisplay" class="score-display" style="display: none;">
                <p>Skor Anda:</p>
                <div class="final-score" id="finalScore">0</div>
            </div>
            <div class="leaderboard-table">
                <div id="leaderboardList"></div>
            </div>
            <button class="btn" onclick="backToDashboard()">üè† Kembali ke Beranda</button>
        </div>
    </div>

    <script>
        // Bank soal dengan 200+ pertanyaan
        const questionBank = [
            // Pengetahuan Umum
            {word: "JAKARTA", clue: "Ibu kota Indonesia", direction: "across"},
            {word: "INDONESIA", clue: "Negara kepulauan terbesar di dunia", direction: "down"},
            {word: "PANCASILA", clue: "Dasar negara Indonesia", direction: "across"},
            {word: "GARUDA", clue: "Burung lambang negara Indonesia", direction: "down"},
            {word: "BHINEKA", clue: "... Tunggal Ika, semboyan Indonesia", direction: "across"},
            {word: "SOEKARNO", clue: "Presiden pertama Indonesia", direction: "down"},
            {word: "HATTA", clue: "Wakil presiden pertama Indonesia", direction: "across"},
            {word: "MERDEKA", clue: "Kata dalam proklamasi kemerdekaan", direction: "down"},
            {word: "MERAH", clue: "Salah satu warna bendera Indonesia", direction: "across"},
            {word: "PUTIH", clue: "Warna lain dalam bendera Indonesia", direction: "down"},
            
            // Geografi
            {word: "SUMATRA", clue: "Pulau terbesar di Indonesia bagian barat", direction: "across"},
            {word: "KALIMANTAN", clue: "Pulau terbesar di Indonesia", direction: "down"},
            {word: "PAPUA", clue: "Pulau paling timur Indonesia", direction: "across"},
            {word: "JAWA", clue: "Pulau terpadat di Indonesia", direction: "down"},
            {word: "SULAWESI", clue: "Pulau berbentuk huruf K", direction: "across"},
            {word: "BALI", clue: "Pulau dewata adalah sebutan untuk pulau", direction: "down"},
            {word: "LOMBOK", clue: "Pulau di sebelah timur Bali", direction: "across"},
            {word: "ACEH", clue: "Provinsi paling ujung barat Indonesia", direction: "down"},
            {word: "MEDAN", clue: "Kota terbesar di Sumatra Utara", direction: "across"},
            {word: "BANDUNG", clue: "Kota kembang di Jawa Barat", direction: "down"},
            {word: "SURABAYA", clue: "Kota pahlawan merupakan julukan untuk kota", direction: "across"},
            {word: "YOGYA", clue: "Kota gudeg", direction: "down"},
            {word: "SEMARANG", clue: "Ibu kota Jawa Tengah", direction: "across"},
            {word: "SOLO", clue: "Kota batik di Jawa Tengah", direction: "down"},
            {word: "MALANG", clue: "Kota apel di Jawa Timur", direction: "across"},
            
            // Budaya
            {word: "BATIK", clue: "Kain tradisional Indonesia", direction: "down"},
            {word: "WAYANG", clue: "Seni pertunjukan tradisional Jawa", direction: "across"},
            {word: "GAMELAN", clue: "Alat musik tradisional Jawa", direction: "down"},
            {word: "KERIS", clue: "Senjata tradisional Jawa", direction: "across"},
            {word: "KEBAYA", clue: "Baju tradisional wanita Indonesia", direction: "down"},
            {word: "SARUNG", clue: "Kain tradisional yang dililitkan", direction: "across"},
            {word: "TARIAN", clue: "Seni gerak tradisional", direction: "down"},
            {word: "LEGONG", clue: "Tarian tradisional Bali", direction: "across"},
            {word: "KECAK", clue: "Tarian Bali dengan suara 'cak'", direction: "down"},
            {word: "PENDET", clue: "Tarian penyambutan dari Bali", direction: "across"},
            
            // Makanan
            {word: "RENDANG", clue: "Makanan Padang berbahan daging", direction: "down"},
            {word: "GUDEG", clue: "Makanan khas Yogyakarta", direction: "across"},
            {word: "CUNGKRING", clue: "Kikil kaki sapi dengan bumbu kacang", direction: "down"},
            {word: "SOTO", clue: "Sup tradisional Indonesia berwarna kuning", direction: "across"},
            {word: "BAKSO", clue: "Bola daging dalam kuah", direction: "down"},
            {word: "SATAY", clue: "Daging tusuk bakar (bahasa Inggris)", direction: "across"},
            {word: "NASI", clue: "Makanan pokok Indonesia", direction: "down"},
            {word: "SAMBAL", clue: "Bumbu pedas khas Indonesia", direction: "across"},
            {word: "TEMPE", clue: "Makanan fermentasi kedelai", direction: "down"},
            {word: "TAHU", clue: "Makanan dari kedelai", direction: "across"},
            {word: "LONTONG", clue: "Beras yang dibungkus daun", direction: "down"},
            {word: "OPOR", clue: "Masakan berkuah santan", direction: "across"},
            {word: "PECEL", clue: "Sayuran dengan bumbu kacang", direction: "down"},
            {word: "RUJAK", clue: "Salad buah pedas manis", direction: "across"},
            
            // Alam
            {word: "KOMODO", clue: "Kadal raksasa dari Indonesia", direction: "down"},
            {word: "ORANGUTAN", clue: "Kera besar dari Kalimantan", direction: "across"},
            {word: "HARIMAU", clue: "Kucing besar bergaris", direction: "down"},
            {word: "GAJAH", clue: "Mamalia terbesar di darat", direction: "across"},
            {word: "BADAK", clue: "Hewan bercula", direction: "down"},
            {word: "ANOA", clue: "Kerbau kerdil dari Sulawesi", direction: "across"},
            {word: "JALAK", clue: "Burung Bali yang langka", direction: "down"},
            {word: "CENDRAWASIH", clue: "Burung surga dari Papua", direction: "across"},
            {word: "RAFFLESIA", clue: "Bunga terbesar di dunia", direction: "down"},
            {word: "DURIAN", clue: "Raja buah yang berbau menyengat", direction: "across"},
            {word: "MANGGIS", clue: "Ratu buah berwarna ungu", direction: "down"},
            {word: "RAMBUTAN", clue: "Buah berambut merah", direction: "across"},
            {word: "SALAK", clue: "Buah bersisik seperti ular", direction: "down"},
            
            // Sejarah
            {word: "MAJAPAHIT", clue: "Kerajaan terbesar di Nusantara", direction: "across"},
            {word: "SRIWIJAYA", clue: "Kerajaan maritim di Sumatra", direction: "down"},
            {word: "DIPONEGORO", clue: "Pangeran yang memimpin perang Jawa", direction: "across"},
            {word: "KARTINI", clue: "Pahlawan emansipasi wanita", direction: "down"},
            {word: "SUDIRMAN", clue: "Jenderal besar TNI", direction: "across"},
            {word: "BOEDI", clue: "... Utomo, organisasi pergerakan pertama", direction: "down"},
            {word: "SUMPAHPEMUDA", clue: "Terjadi pada tahun 1928", direction: "across"},
            {word: "PROKLAMASI", clue: "Pembacaan kemerdekaan Indonesia", direction: "down"},
            {word: "AGUSTUS", clue: "Bulan proklamasi kemerdekaan", direction: "across"},
            {word: "SAYUTIMELIK", clue: "Yang mengetik naskah proklamasi", direction: "down"},
            
            // Teknologi dan Sains
            {word: "KOMPUTER", clue: "Mesin pengolah data elektronik", direction: "across"},
            {word: "INTERNET", clue: "Jaringan komputer global", direction: "down"},
            {word: "ROBOT", clue: "Mesin otomatis mirip manusia", direction: "across"},
            {word: "SATELIT", clue: "Benda buatan yang mengorbit bumi", direction: "down"},
            {word: "LISTRIK", clue: "Energi yang mengalir melalui kabel", direction: "across"},
            {word: "MAGNET", clue: "Benda yang menarik besi", direction: "down"},
            {word: "ATOM", clue: "Partikel terkecil suatu unsur", direction: "across"},
            {word: "MOLEKUL", clue: "Gabungan beberapa atom", direction: "down"},
            {word: "ENERGI", clue: "Kemampuan untuk melakukan kerja", direction: "across"},
            {word: "GRAVITASI", clue: "Gaya tarik bumi", direction: "down"},
            
            // Olahraga
            {word: "SEPAKBOLA", clue: "Jay Idzes adalah pemain", direction: "across"},
            {word: "BULUTANGKIS", clue: "Taufik Hidayat merupakan atlet", direction: "down"},
            {word: "RENANG", clue: "Olahraga di dalam air", direction: "across"},
            {word: "LARI", clue: "Olahraga atletik tercepat", direction: "down"},
            {word: "BASKET", clue: "Olahraga dengan ring tinggi", direction: "across"},
            {word: "VOLI", clue: "Olahraga dengan net pembatas", direction: "down"},
            {word: "TENIS", clue: "Olahraga dengan raket dan bola", direction: "across"},
            {word: "GOLF", clue: "Olahraga dengan bola kecil dan lubang", direction: "down"},
            {word: "TINJU", clue: "Olahraga dengan sarung tangan", direction: "across"},
            {word: "KARATE", clue: "Bela diri asal Jepang", direction: "down"},
            
            // Seni dan Hiburan
            {word: "MUSIK", clue: "Seni suara dan nada", direction: "across"},
            {word: "LUKIS", clue: "Seni gambar dengan cat", direction: "down"},
            {word: "PATUNG", clue: "Karya seni tiga dimensi", direction: "across"},
            {word: "TEATER", clue: "Pertunjukan drama di panggung", direction: "down"},
            {word: "FILM", clue: "Karya seni gambar bergerak", direction: "across"},
            {word: "NOVEL", clue: "Karya sastra panjang", direction: "down"},
            {word: "PUISI", clue: "Karya sastra dengan ritme", direction: "across"},
            {word: "LAGU", clue: "Musik dengan lirik", direction: "down"},
            {word: "DANCE", clue: "Seni gerak mengikuti irama", direction: "across"},
            {word: "OPERA", clue: "Pertunjukan musik dan drama", direction: "down"},
            
            // Profesi
            {word: "DOKTER", clue: "Profesi penyembuh orang sakit", direction: "across"},
            {word: "GURU", clue: "Profesi pendidik", direction: "down"},
            {word: "PILOT", clue: "Pengemudi pesawat terbang", direction: "across"},
            {word: "POLISI", clue: "Penjaga keamanan dan ketertiban", direction: "down"},
            {word: "HAKIM", clue: "Penegak hukum di pengadilan", direction: "across"},
            {word: "INSINYUR", clue: "Ahli teknik dan rekayasa", direction: "down"},
            {word: "ARSITEK", clue: "Perancang bangunan", direction: "across"},
            {word: "PELAUT", clue: "Profesi yang bekerja di laut", direction: "down"},
            {word: "PETANI", clue: "Profesi pengolah tanah pertanian", direction: "across"},
            {word: "NELAYAN", clue: "Pencari ikan di laut", direction: "down"},
            
            // Angka dan Matematika
            {word: "SATU", clue: "Angka setelah nol", direction: "across"},
            {word: "DUA", clue: "Angka genap terkecil", direction: "down"},
            {word: "TIGA", clue: "Jumlah sisi segitiga", direction: "across"},
            {word: "EMPAT", clue: "Jumlah sisi persegi", direction: "down"},
            {word: "LIMA", clue: "Jumlah jari dalam satu tangan", direction: "across"},
            {word: "ENAM", clue: "Setengah dari dua belas", direction: "down"},
            {word: "TUJUH", clue: "Hari dalam seminggu", direction: "across"},
            {word: "DELAPAN", clue: "Dua kali empat", direction: "down"},
            {word: "SEMBILAN", clue: "Tiga kali tiga", direction: "across"},
            {word: "SEPULUH", clue: "Basis sistem bilangan desimal", direction: "down"},
            {word: "PLUS", clue: "Operasi penjumlahan", direction: "across"},
            {word: "MINUS", clue: "Operasi pengurangan", direction: "down"},
            {word: "KALI", clue: "Operasi perkalian", direction: "across"},
            {word: "BAGI", clue: "Operasi pembagian", direction: "down"},
            
            // Warna
            {word: "HITAM", clue: "Warna gelap tanpa cahaya", direction: "across"},
            {word: "PUTIH", clue: "Warna terang seperti salju", direction: "down"},
            {word: "MERAH", clue: "Warna darah", direction: "across"},
            {word: "BIRU", clue: "Warna langit", direction: "down"},
            {word: "HIJAU", clue: "Warna daun", direction: "across"},
            {word: "KUNING", clue: "Warna matahari", direction: "down"},
            {word: "UNGU", clue: "Campuran merah dan biru", direction: "across"},
            {word: "ORANGE", clue: "Warna buah jeruk", direction: "down"},
            {word: "COKLAT", clue: "Warna tanah", direction: "across"},
            {word: "PINK", clue: "Warna merah muda", direction: "down"},
            
            // Keluarga
            {word: "AYAH", clue: "Orang tua laki-laki", direction: "across"},
            {word: "IBU", clue: "Orang tua perempuan", direction: "down"},
            {word: "ANAK", clue: "Keturunan orang tua", direction: "across"},
            {word: "KAKAK", clue: "Saudara yang lebih tua", direction: "down"},
            {word: "ADIK", clue: "Saudara yang lebih muda", direction: "across"},
            {word: "KAKEK", clue: "Ayah dari orang tua", direction: "down"},
            {word: "NENEK", clue: "Ibu dari orang tua", direction: "across"},
            {word: "PAMAN", clue: "Saudara laki-laki orang tua", direction: "down"},
            {word: "BIBI", clue: "Saudara perempuan orang tua", direction: "across"},
            {word: "SEPUPU", clue: "Anak dari paman atau bibi", direction: "down"},
            
            // Waktu
            {word: "SATUHARI", clue: "Periode 24 jam", direction: "across"},
            {word: "SATUMINGGU", clue: "Tujuh hari", direction: "down"},
            {word: "SATUBULAN", clue: "3O hari sama dengan", direction: "across"},
            {word: "SATUTAHUN", clue: "Dua belas bulan sama dengan", direction: "down"},
            {word: "JAM", clue: "Alat penunjuk waktu", direction: "across"},
            {word: "MENIT", clue: "Enam puluh detik", direction: "down"},
            {word: "DETIK", clue: "Satuan waktu terkecil", direction: "across"},
            {word: "PAGI", clue: "Waktu setelah matahari terbit", direction: "down"},
            {word: "SIANG", clue: "Waktu matahari di atas kepala", direction: "across"},
            {word: "SORE", clue: "Waktu menjelang maghrib", direction: "down"},
            {word: "MALAM", clue: "Waktu setelah matahari terbenam", direction: "across"},
            
            // Cuaca
            {word: "HUJAN", clue: "Air yang turun dari langit", direction: "down"},
            {word: "PANAS", clue: "Cuaca dengan suhu tinggi", direction: "across"},
            {word: "DINGIN", clue: "Cuaca dengan suhu rendah", direction: "down"},
            {word: "ANGIN", clue: "Udara yang bergerak", direction: "across"},
            {word: "MENDUNG", clue: "Langit tertutup awan", direction: "down"},
            {word: "CERAH", clue: "Cuaca tanpa awan", direction: "across"},
            {word: "PETIR", clue: "Kilat disertai suara guntur", direction: "down"},
            {word: "KABUT", clue: "Uap air di udara", direction: "across"},
            {word: "SALJU", clue: "Air beku yang turun", direction: "down"},
            
            // Transportasi
            {word: "MOBIL", clue: "Kendaraan beroda empat", direction: "across"},
            {word: "MOTOR", clue: "Kendaraan beroda dua", direction: "down"},
            {word: "PESAWAT", clue: "Kendaraan yang terbang", direction: "across"},
            {word: "KAPAL", clue: "Kendaraan air", direction: "down"},
            {word: "KERETA", clue: "Kendaraan di rel", direction: "across"},
            {word: "BUS", clue: "Kendaraan umum berkapasitas besar", direction: "down"},
            {word: "SEPEDA", clue: "Kendaraan beroda dua tanpa mesin", direction: "across"},
            {word: "BECAK", clue: "Kendaraan tradisional beroda tiga", direction: "down"},
            {word: "OJEK", clue: "Transportasi motor untuk satu penumpang", direction: "across"},
            {word: "TAXI", clue: "Mobil sewa dengan sopir", direction: "down"},
            
            // Pendidikan
            {word: "SEKOLAH", clue: "Tempat menuntut ilmu", direction: "across"},
            {word: "BUKU", clue: "Kumpulan kertas berisi tulisan", direction: "down"},
            {word: "PENSIL", clue: "Alat tulis dari kayu", direction: "across"},
            {word: "PULPEN", clue: "Alat tulis dengan tinta", direction: "down"},
            {word: "KERTAS", clue: "Media untuk menulis", direction: "across"},
            {word: "PAPANTULIS", clue: "Tempat menulis di depan kelas", direction: "down"},
            {word: "MEJA", clue: "Tempat untuk belajar", direction: "across"},
            {word: "KURSI", clue: "Tempat untuk duduk", direction: "down"},
            {word: "KELAS", clue: "Ruangan untuk belajar", direction: "across"},
            {word: "UJIAN", clue: "Tes untuk mengukur kemampuan", direction: "down"},
        ];

        // Game state variables
        let currentPlayer = '';
        let gameStartTime = 0;
        let gameTimer = null;
        let helpRemaining = 5;
        let currentGrid = [];
        let currentWords = [];
        let gridSize = 15;
        let currentClue = null;
        let gameData = { across: {}, down: {} };
        
        // New state for scoring
        let wordStatus = {};

        // Variabel global baru untuk menyimpan arah aktif saat input
        let activeDirectionForInput = null;

        // Load leaderboard from localStorage alternative (using a global variable)
        let leaderboardData = [];

        function initGame() {
            // No need to load sample data, start with an empty array
            showScreen('dashboardScreen');
        }

        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function startGame() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                alert('Silakan masukkan nama Anda terlebih dahulu!');
                return;
            }

            currentPlayer = playerName;
            document.getElementById('currentPlayer').textContent = currentPlayer;
            helpRemaining = 5;
            wordStatus = {};
            updateGameStats();
            
            // Reset active direction
            activeDirectionForInput = null;

            generateCrosswordPuzzle();
            startTimer();
            showScreen('gameScreen');
        }

        function generateCrosswordPuzzle() {
            // Reset game data
            currentGrid = [];
            currentWords = [];
            gameData = { across: {}, down: {} };
            
            // Initialize empty grid
            for (let i = 0; i < gridSize; i++) {
                currentGrid[i] = [];
                for (let j = 0; j < gridSize; j++) {
                    currentGrid[i][j] = { letter: '', number: 0, blocked: true };
                }
            }

            // Select random words from bank
            const availableWords = [...questionBank];
            const selectedWords = [];
            
            // Get 10 across and 10 down words
            const acrossWords = availableWords.filter(w => w.direction === 'across');
            const downWords = availableWords.filter(w => w.direction === 'down');
            
            // Randomly select words
            for (let i = 0; i < 10 && acrossWords.length > 0; i++) {
                const randomIndex = Math.floor(Math.random() * acrossWords.length);
                selectedWords.push(acrossWords.splice(randomIndex, 1)[0]);
            }
            
            for (let i = 0; i < 10 && downWords.length > 0; i++) {
                const randomIndex = Math.floor(Math.random() * downWords.length);
                selectedWords.push(downWords.splice(randomIndex, 1)[0]);
            }

            // Place words in grid using a simple placement algorithm
            let wordNumber = 1;
            selectedWords.forEach((wordData) => {
                const placed = placeWordInGrid(wordData, wordNumber);
                if (placed) {
                    // Initialize word status
                    wordStatus[`${wordData.direction}-${wordNumber}`] = {
                        answered: false,
                        usedHelp: false
                    };
                    wordNumber++;
                }
            });

            renderGrid();
            renderClues();
        }

        function placeWordInGrid(wordData, number) {
            const word = wordData.word;
            const direction = wordData.direction;
            const maxAttempts = 50;
            
            for (let attempt = 0; attempt < maxAttempts; attempt++) {
                let row, col;
                
                if (direction === 'across') {
                    row = Math.floor(Math.random() * gridSize);
                    col = Math.floor(Math.random() * (gridSize - word.length + 1));
                    
                    // Check if placement is valid
                    let canPlace = true;
                    for (let i = 0; i < word.length; i++) {
                        if (currentGrid[row][col + i].letter !== '' && 
                            currentGrid[row][col + i].letter !== word[i]) {
                            canPlace = false;
                            break;
                        }
                    }
                    
                    if (canPlace) {
                        // Place the word
                        for (let i = 0; i < word.length; i++) {
                            currentGrid[row][col + i].letter = word[i];
                            currentGrid[row][col + i].blocked = false;
                        }
                        currentGrid[row][col].number = number;
                        
                        gameData.across[number] = {
                            word: word,
                            clue: wordData.clue,
                            direction: direction, // Add direction to gameData
                            row: row,
                            col: col,
                            length: word.length
                        };
                        
                        currentWords.push({
                            word: word,
                            clue: wordData.clue,
                            direction: direction,
                            number: number,
                            row: row,
                            col: col
                        });
                        
                        return true;
                    }
                } else { // down
                    row = Math.floor(Math.random() * (gridSize - word.length + 1));
                    col = Math.floor(Math.random() * gridSize);
                    
                    // Check if placement is valid
                    let canPlace = true;
                    for (let i = 0; i < word.length; i++) {
                        if (currentGrid[row + i][col].letter !== '' && 
                            currentGrid[row + i][col].letter !== word[i]) {
                            canPlace = false;
                            break;
                        }
                    }
                    
                    if (canPlace) {
                        // Place the word
                        for (let i = 0; i < word.length; i++) {
                            currentGrid[row + i][col].letter = word[i];
                            currentGrid[row + i][col].blocked = false;
                        }
                        currentGrid[row][col].number = number;
                        
                        gameData.down[number] = {
                            word: word,
                            clue: wordData.clue,
                            direction: direction, // Add direction to gameData
                            row: row,
                            col: col,
                            length: word.length
                        };
                        
                        currentWords.push({
                            word: word,
                            clue: wordData.clue,
                            direction: direction,
                            number: number,
                            row: row,
                            col: col
                        });
                        
                        return true;
                    }
                }
            }
            
            return false;
        }

        function renderGrid() {
            const gridContainer = document.getElementById('crosswordGrid');
            gridContainer.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
            gridContainer.innerHTML = '';

            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;

                    if (currentGrid[i][j].blocked) {
                        cell.classList.add('blocked');
                    } else {
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.maxLength = 1;
                        // Menggunakan keyup untuk mendeteksi input dan memindahkan kursor
                        input.addEventListener('keyup', handleInput);
                        input.addEventListener('focus', handleCellFocus);
                        cell.appendChild(input);

                        if (currentGrid[i][j].number > 0) {
                            const number = document.createElement('span');
                            number.className = 'cell-number';
                            number.textContent = currentGrid[i][j].number;
                            cell.appendChild(number);
                        }
                    }

                    gridContainer.appendChild(cell);
                }
            }
        }

        function renderClues() {
            const acrossClues = document.getElementById('acrossClues');
            const downClues = document.getElementById('downClues');
            
            acrossClues.innerHTML = '';
            downClues.innerHTML = '';

            // Render across clues
            Object.keys(gameData.across).sort((a, b) => parseInt(a) - parseInt(b)).forEach(number => {
                const clueData = gameData.across[number];
                const clueElement = document.createElement('div');
                clueElement.className = 'clue-item';
                clueElement.innerHTML = `<strong>${number}.</strong> ${clueData.clue}`;
                clueElement.addEventListener('click', () => highlightWord(number, 'across'));
                acrossClues.appendChild(clueElement);
            });

            // Render down clues
            Object.keys(gameData.down).sort((a, b) => parseInt(a) - parseInt(b)).forEach(number => {
                const clueData = gameData.down[number];
                const clueElement = document.createElement('div');
                clueElement.className = 'clue-item';
                clueElement.innerHTML = `<strong>${number}.</strong> ${clueData.clue}`;
                clueElement.addEventListener('click', () => highlightWord(number, 'down'));
                downClues.appendChild(clueElement);
            });
        }

        function highlightWord(number, direction) {
            // Remove previous highlights
            document.querySelectorAll('.cell').forEach(cell => {
                cell.classList.remove('highlight');
            });
            document.querySelectorAll('.clue-item').forEach(clue => {
                clue.classList.remove('active');
            });

            const wordData = gameData[direction][number];
            if (!wordData) return;

            currentClue = { number, direction };
            // Set arah aktif untuk input
            activeDirectionForInput = direction;

            // Highlight cells
            for (let i = 0; i < wordData.length; i++) {
                let row, col;
                if (direction === 'across') {
                    row = wordData.row;
                    col = wordData.col + i;
                } else {
                    row = wordData.row + i;
                    col = wordData.col;
                }

                const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                if (cell) {
                    cell.classList.add('highlight');
                }
            }

            // Highlight active clue
            const clueElements = direction === 'across' 
                ? document.querySelectorAll('#acrossClues .clue-item')
                : document.querySelectorAll('#downClues .clue-item');
            
            // Temukan indeks clue yang benar berdasarkan nomor
            let clueIndex = -1;
            const sortedClueNumbers = Object.keys(gameData[direction]).sort((a, b) => parseInt(a) - parseInt(b));
            for(let i = 0; i < sortedClueNumbers.length; i++) {
                if (parseInt(sortedClueNumbers[i]) === parseInt(number)) {
                    clueIndex = i;
                    break;
                }
            }

            if (clueIndex !== -1 && clueElements[clueIndex]) {
                clueElements[clueIndex].classList.add('active');
            }
        }

        function handleCellFocus(event) {
            const cell = event.target.closest('.cell');
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            
            // Hapus highlight sebelumnya
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('highlight'));
            document.querySelectorAll('.clue-item').forEach(clue => clue.classList.remove('active'));

            let wordsInCell = [];

            // Cari kata-kata yang melewati sel ini
            for (const word of currentWords) {
                if (word.direction === 'across') {
                    if (word.row === row && col >= word.col && col < word.col + word.word.length) {
                        wordsInCell.push({ number: word.number, direction: 'across', clue: word.clue });
                    }
                } else { // down
                    if (word.col === col && row >= word.row && row < word.row + word.word.length) {
                        wordsInCell.push({ number: word.number, direction: 'down', clue: word.clue });
                    }
                }
            }

            if (wordsInCell.length === 1) {
                // Jika hanya satu kata, langsung sorot
                highlightWord(wordsInCell[0].number, wordsInCell[0].direction);
            } else if (wordsInCell.length > 1) {
                // Jika lebih dari satu kata (berpotongan), tanyakan pengguna atau gunakan arah terakhir
                let preferredWord = null;
                if (activeDirectionForInput) {
                    preferredWord = wordsInCell.find(w => w.direction === activeDirectionForInput);
                }

                if (preferredWord) {
                    highlightWord(preferredWord.number, preferredWord.direction);
                } else {
                    // Jika tidak ada arah aktif sebelumnya atau tidak cocok, tanyakan pengguna
                    let message = 'Sel ini adalah bagian dari beberapa kata. Pilih kata yang ingin Anda isi:\n';
                    wordsInCell.forEach((w, index) => {
                        message += `${index + 1}. ${w.clue} (${w.direction === 'across' ? 'Mendatar' : 'Menurun'})\n`;
                    });

                    const choice = prompt(message + 'Masukkan nomor pilihan Anda:');
                    const selectedIndex = parseInt(choice) - 1;

                    if (!isNaN(selectedIndex) && selectedIndex >= 0 && selectedIndex < wordsInCell.length) {
                        const selectedWord = wordsInCell[selectedIndex];
                        highlightWord(selectedWord.number, selectedWord.direction);
                    } else {
                        // Jika pilihan tidak valid, biarkan tanpa highlight atau berikan pesan
                        currentClue = null;
                        activeDirectionForInput = null;
                        alert('Pilihan tidak valid. Silakan pilih lagi atau klik sel lain.');
                    }
                }
            } else {
                // Tidak ada kata di sel ini (seharusnya tidak terjadi jika grid dibuat dengan benar)
                currentClue = null;
                activeDirectionForInput = null;
            }
        }

        function handleInput(event) {
            // Hanya jalankan logika pindah kursor jika event adalah keyup
            if (event.type === 'keyup') {
                const key = event.key.toUpperCase();
                // Hanya pindah kursor jika yang diketik adalah huruf alfabet
                if (key.length === 1 && key.match(/[A-Z]/)) {
                    const currentCell = event.target.closest('.cell');
                    const currentRow = parseInt(currentCell.dataset.row);
                    const currentCol = parseInt(currentCell.dataset.col);

                    // Gunakan activeDirectionForInput untuk menentukan arah perpindahan
                    if (!activeDirectionForInput || !currentClue) {
                        // Jika tidak ada arah aktif atau clue, jangan pindah kursor otomatis
                        return;
                    }

                    const wordData = gameData[activeDirectionForInput][currentClue.number];
                    if (!wordData) return; // Pastikan wordData ada

                    const wordLength = wordData.length;
                    
                    let nextRow = currentRow;
                    let nextCol = currentCol;
                    
                    let isLastCell = false;

                    if (activeDirectionForInput === 'across') {
                        const cellIndex = currentCol - wordData.col;
                        if (cellIndex < wordLength - 1) {
                            nextCol = currentCol + 1;
                        } else {
                            isLastCell = true;
                        }
                    } else { // down
                        const cellIndex = currentRow - wordData.row;
                        if (cellIndex < wordLength - 1) {
                            nextRow = currentRow + 1;
                        } else {
                            isLastCell = true;
                        }
                    }

                    if (!isLastCell) {
                        const nextCellInput = document.querySelector(`.cell[data-row="${nextRow}"][data-col="${nextCol}"] input`);
                        if (nextCellInput) {
                            nextCellInput.focus();
                        }
                    }
                }
            }
        }

        function calculateScore() {
            // Fungsi ini tidak lagi digunakan untuk perhitungan skor real-time
            // Skor dihitung di akhir permainan oleh finalCorrection()
            document.getElementById('currentScore').textContent = 'Hitung di akhir'; // Placeholder
        }

        function updateGameStats() {
            document.getElementById('helpCount').textContent = helpRemaining;
            document.getElementById('currentScore').textContent = '0';
        }

        function startTimer() {
            gameStartTime = Date.now();
            gameTimer = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - gameStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('gameTimer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function getHelp() {
            if (helpRemaining <= 0) {
                showPopup('Bantuan sudah habis!', 'Anda telah menggunakan semua bantuan yang tersedia.');
                return;
            }

            if (!currentClue) {
                showPopup('Pilih Kata Terlebih Dahulu', 'Klik pada salah satu petunjuk untuk memilih kata yang ingin dibantu.');
                return;
            }

            const wordData = gameData[currentClue.direction][currentClue.number];
            const wordKey = `${currentClue.direction}-${currentClue.number}`;

            if (wordStatus[wordKey].answered) {
                 showPopup('Kata Sudah Lengkap', 'Semua huruf dalam kata ini sudah terisi dan sudah dinilai.');
                 return;
            }
            
            wordStatus[wordKey].usedHelp = true;

            // Find first empty cell in the current word
            for (let i = 0; i < wordData.word.length; i++) {
                let row, col;
                if (currentClue.direction === 'across') {
                    row = wordData.row;
                    col = wordData.col + i;
                } else {
                    row = wordData.row + i;
                    col = wordData.col;
                }

                const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"] input`);
                if (cell && !cell.value) {
                    cell.value = wordData.word[i];
                    helpRemaining--;
                    updateGameStats();
                    showPopup('Bantuan Diberikan!', `Huruf "${wordData.word[i]}" telah diisi.`);
                    return;
                }
            }
            showPopup('Tidak ada sel kosong', 'Semua sel untuk kata ini sudah terisi.');
        }

        // MODIFIED: showPopup to accept a callback
        function showPopup(title, message, callback = null) {
            const popup = document.createElement('div');
            popup.className = 'popup';
            popup.innerHTML = `
                <div class="popup-content">
                    <h3>${title}</h3>
                    <p>${message}</p>
                    <button class="btn" id="popupOkBtn">OK</button>
                </div>
            `;
            document.body.appendChild(popup);

            document.getElementById('popupOkBtn').onclick = () => {
                closePopup();
                if (callback) {
                    callback();
                }
            };
        }

        function closePopup() {
            const popup = document.querySelector('.popup');
            if (popup) {
                popup.remove();
            }
        }

        // MODIFIED: finishGame to show review and then leaderboard
        function finishGame() {
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }

            // Perform final correction and scoring
            const finalScore = finalCorrection();

            // Show final score in a popup first
            showPopup('Permainan Selesai!', `Skor akhir Anda: ${finalScore} poin.`, () => {
                // After popup is closed, save score and show leaderboard
                saveScore(currentPlayer, finalScore);
                document.getElementById('finalScore').textContent = finalScore;
                document.getElementById('scoreDisplay').style.display = 'block';
                showLeaderboard();
            });
        }

        // MODIFIED: finalCorrection to apply colors and lock inputs
        function finalCorrection() {
            let finalScore = 0;
            
            // Clear all previous highlight classes
            document.querySelectorAll('.cell').forEach(cell => {
                cell.classList.remove('highlight'); // Remove highlight from active clue
            });
            document.querySelectorAll('.clue-item').forEach(clue => {
                clue.classList.remove('active'); // Remove active state from clues
            });
            
            // Lock all inputs and remove any existing correct/incorrect classes
            document.querySelectorAll('.cell input').forEach(input => {
                input.readOnly = true;
                const cell = input.closest('.cell');
                cell.classList.remove('correct', 'incorrect'); // Clear previous colors
            });

            // Check each word and color the cells
            currentWords.forEach(wordData => {
                const word = wordData.word;
                let isWordCorrect = true;

                for (let i = 0; i < word.length; i++) {
                    let row, col;
                    if (wordData.direction === 'across') {
                        row = wordData.row;
                        col = wordData.col + i;
                    } else {
                        row = wordData.row + i;
                        col = wordData.col;
                    }

                    const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                    const input = cell.querySelector('input');
                    
                    if (input) { // Ensure there's an input field in the cell
                        if (input.value.toUpperCase() !== word[i]) {
                            isWordCorrect = false;
                            cell.classList.add('incorrect'); // Mark as incorrect
                        } else {
                            cell.classList.add('correct'); // Mark as correct
                        }
                    } else {
                        // This case should ideally not happen for non-blocked cells that are part of a word
                        isWordCorrect = false; 
                    }
                }

                // Calculate points for this word
                const wordKey = `${wordData.direction}-${wordData.number}`;
                const hasUsedHelp = wordStatus[wordKey] && wordStatus[wordKey].usedHelp;

                if (isWordCorrect) {
                    finalScore += hasUsedHelp ? 50 : 100; // 100 poin jika benar, 50 jika benar tapi pakai bantuan
                } else {
                    finalScore += 10; // 10 poin jika salah (tapi terisi)
                }
            });

            return finalScore;
        }

        function saveScore(playerName, score) {
            leaderboardData.push({ name: playerName, score: score, date: new Date().toLocaleDateString() });
            leaderboardData.sort((a, b) => b.score - a.score);
            leaderboardData = leaderboardData.slice(0, 10); // Keep only top 10
        }

        function showLeaderboard() {
            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = '';

            if (leaderboardData.length === 0) {
                leaderboardList.innerHTML = '<p style="text-align: center; opacity: 0.7;">Belum ada data peringkat</p>';
            } else {
                leaderboardData.forEach((entry, index) => {
                    const entryElement = document.createElement('div');
                    entryElement.className = 'leaderboard-entry';
                    entryElement.innerHTML = `
                        <span>${index + 1}. ${entry.name}</span>
                        <span>${entry.score} pts</span>
                    `;
                    leaderboardList.appendChild(entryElement);
                });
            }

            showScreen('leaderboardScreen');
        }

        function backToDashboard() {
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
            
            // Reset game state
            currentPlayer = '';
            document.getElementById('playerName').value = '';
            document.getElementById('scoreDisplay').style.display = 'none';
            
            showScreen('dashboardScreen');
        }

        // Initialize game when page loads
        window.addEventListener('load', initGame);
        
        // Handle clicks outside popup to close
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('popup')) {
                // Only close if the click is directly on the popup overlay, not its content
                if (event.target === document.querySelector('.popup')) {
                    closePopup();
                }
            }
        });
    </script>
</body>
</html>
